<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SVG Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.15/paper-full.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="swatches"></div>
    <button id="downloadSvg">Download SVG</button>

    <script>
        // Initialize Paper.js
        paper.setup('myCanvas');

        // Read SVG from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const svgUrl = urlParams.get('svg');
        
        if (svgUrl) {
            // Fetch and load SVG
            fetch(svgUrl)
            .then(response => response.text())
            .then(data => {
                const svg = data;
                paper.project.importSVG(svg, {
                    onLoad: function(item) {
                        // Flatten the SVG
                        item.rasterize(72, false);

                        // Extract colors and create swatches
                        const colors = new Set();  // To store unique colors
                        item.traverse(function(path) {
                            if (path.fillColor) {
                                colors.add(path.fillColor.toCSS());
                            }
                        });

                        colors.forEach(color => {
                            const swatch = $('<div class="swatch"></div>');
                            swatch.css('background-color', color);
                            swatch.click(function() {
                                // Delete color on swatch click
                                item.traverse(function(path) {
                                    if (path.fillColor && path.fillColor.toCSS() === color) {
                                        path.remove();
                                    }
                                });
                            });
                            $('#swatches').append(swatch);
                        });
                    }
                });
            });
        }

        $('#downloadSvg').click(function() {
            const svgData = paper.project.exportSVG({ asString: true });
            const blob = new Blob([svgData], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'modified.svg';
            link.click();
            URL.revokeObjectURL(url);
        });
    </script>

    <style>
        /* Add your Google Web Fonts and Google Material Design styles here */
        .swatch {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</body>
</html>
