<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SVG Flattener</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.2/paper-full.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div id="swatches"></div>
  <canvas id="canvas" resize></canvas>
  <button id="download">Download SVG</button>

  <script>
    // Get the SVG URL parameter from the query string
    const urlParams = new URLSearchParams(window.location.search);
    const svgUrl = urlParams.get('svg');

    // Load the SVG into the canvas using Paper.js
    paper.setup('canvas');
    paper.project.importSVG(svgUrl, function(item) {
      // Flatten the SVG to remove overlapping paths
      item.flatten(10);

      // Extract the colors used in the logo and display them as swatches
      const colors = new Set();
      item.children.forEach(function(child) {
        if (child.fillColor) {
          colors.add(child.fillColor.toCSS(true));
        }
      });
      colors.forEach(function(color) {
        const swatch = $('<div>').addClass('swatch').css('background-color', color);
        $('#swatches').append(swatch);
        swatch.click(function() {
          if (swatch.hasClass('deleted')) {
            swatch.removeClass('deleted');
            item.children.forEach(function(child) {
              if (child.fillColor && child.fillColor.toCSS(true) === color) {
                child.visible = true;
              }
            });
          } else {
            swatch.addClass('deleted');
            item.children.forEach(function(child) {
              if (child.fillColor && child.fillColor.toCSS(true) === color) {
                child.visible = false;
              }
            });
          }
        });
      });

      // Download the modified SVG when the button is clicked
      $('#download').click(function() {
        const svgData = item.exportSVG({ asString: true });
        const downloadLink = document.createElement('a');
        downloadLink.href = 'data:image/svg+xml;base64,' + btoa(svgData);
        downloadLink.download = 'modified.svg';
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
      });
    });
  </script>

  <style>
    body {
      background-color: #eee;
    }
    #swatches {
      margin-bottom: 20px;
    }
    .swatch {
      display: inline-block;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      margin-right: 10px;
      cursor: pointer;
    }
    .deleted:after {
      content: 'X';
      display: block;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: white;
    }
  </style>
</body>
</html>
